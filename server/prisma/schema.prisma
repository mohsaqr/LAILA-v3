generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// =============================================================================
// USER & AUTHENTICATION
// =============================================================================

model User {
  id            Int       @id @default(autoincrement())
  fullname      String
  email         String    @unique
  passwordHash  String    @map("password_hash")
  isAdmin       Boolean   @default(false) @map("is_admin")
  isConfirmed   Boolean   @default(false) @map("is_confirmed")
  isInstructor  Boolean   @default(false) @map("is_instructor")
  isActive      Boolean   @default(true) @map("is_active")
  createdAt     DateTime  @default(now()) @map("created_at")
  lastLogin     DateTime? @map("last_login")

  // Relations
  settings          UserSetting[]
  chatLogs          ChatLog[]
  userInteractions  UserInteraction[]
  userSubmissions   UserSubmission[]
  dataAnalysisLogs  DataAnalysisLog[]

  // LMS Relations
  taughtCourses     Course[]             @relation("InstructorCourses")
  enrollments       Enrollment[]
  submissions       AssignmentSubmission[] @relation("StudentSubmissions")
  gradedSubmissions AssignmentSubmission[] @relation("GradedBy")
  announcements     CourseAnnouncement[]
  chatbotConversations ChatbotConversation[]
  chatbotInteractionLogs ChatbotInteractionLog[]
  userInteractionLogs UserInteractionLog[]

  @@map("users")
}

model UserSetting {
  id           Int      @id @default(autoincrement())
  userId       Int      @map("user_id")
  settingKey   String   @map("setting_key")
  settingValue String?  @map("setting_value")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, settingKey])
  @@map("user_settings")
}

// =============================================================================
// SYSTEM SETTINGS
// =============================================================================

model SystemSetting {
  id           Int      @id @default(autoincrement())
  settingKey   String   @unique @map("setting_key")
  settingValue String?  @map("setting_value")
  settingType  String   @default("string") @map("setting_type")
  description  String?
  isEncrypted  Boolean  @default(false) @map("is_encrypted")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  @@map("system_settings")
}

model ApiConfiguration {
  id               Int      @id @default(autoincrement())
  serviceName      String   @unique @map("service_name")
  apiKey           String?  @map("api_key")
  defaultModel     String?  @map("default_model")
  isActive         Boolean  @default(true) @map("is_active")
  rateLimit        Int?     @map("rate_limit")
  configurationData String? @map("configuration_data")
  createdAt        DateTime @default(now()) @map("created_at")
  updatedAt        DateTime @updatedAt @map("updated_at")

  @@map("api_configurations")
}

// =============================================================================
// LOGGING & ANALYTICS
// =============================================================================

model ChatLog {
  id             Int      @id @default(autoincrement())
  userId         Int?     @map("user_id")
  sessionId      String?  @map("session_id")
  timestamp      DateTime
  module         String
  sender         String   // 'User' or 'AI'
  turn           Int
  message        String
  aiModel        String?  @map("ai_model")
  responseTimeSec Float?  @map("response_time_sec")
  context        String?
  createdAt      DateTime @default(now()) @map("created_at")

  user User? @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@index([userId])
  @@index([timestamp])
  @@index([module])
  @@map("chat_logs")
}

model UserInteraction {
  id              Int      @id @default(autoincrement())
  userId          Int?     @map("user_id")
  sessionId       String?  @map("session_id")
  interactionType String?  @map("interaction_type")
  page            String?
  action          String?
  elementId       String?  @map("element_id")
  elementType     String?  @map("element_type")
  elementValue    String?  @map("element_value")
  timestamp       DateTime
  userAgent       String?  @map("user_agent")
  ipAddress       String?  @map("ip_address")
  additionalData  String?  @map("additional_data")

  user User? @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@index([userId])
  @@index([timestamp])
  @@map("user_interactions")
}

model UserSubmission {
  id              Int      @id @default(autoincrement())
  userId          Int?     @map("user_id")
  submissionType  String?  @map("submission_type")
  submissionData  String?  @map("submission_data")
  vignetteContent String?  @map("vignette_content")
  nationality     String?
  gender          String?
  fieldOfStudy    String?  @map("field_of_study")
  academicLevel   String?  @map("academic_level")
  submittedAt     DateTime @default(now()) @map("submitted_at")

  user User? @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@map("user_submissions")
}

model DataAnalysisLog {
  id               Int      @id @default(autoincrement())
  userId           Int?     @map("user_id")
  analysisType     String?  @map("analysis_type")
  fileName         String?  @map("file_name")
  fileSize         Int?     @map("file_size")
  analysisResult   String?  @map("analysis_result")
  aiModel          String?  @map("ai_model")
  processingTimeSec Float?  @map("processing_time_sec")
  timestamp        DateTime
  status           String   @default("completed")

  user User? @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@map("data_analysis_logs")
}

// =============================================================================
// CHATBOTS
// =============================================================================

model Chatbot {
  id          Int      @id @default(autoincrement())
  name        String   @unique
  displayName String   @map("display_name")
  description String?
  systemPrompt String  @map("system_prompt")
  category    String?
  isActive    Boolean  @default(true) @map("is_active")
  isSystem    Boolean  @default(false) @map("is_system")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  @@map("chatbots")
}

// =============================================================================
// LMS - COURSES
// =============================================================================

model Course {
  id           Int       @id @default(autoincrement())
  title        String
  slug         String    @unique
  description  String?
  thumbnail    String?
  instructorId Int       @map("instructor_id")
  category     String?
  difficulty   String?   // beginner, intermediate, advanced
  status       String    @default("draft") // draft, published, archived
  isPublic     Boolean   @default(true) @map("is_public")
  createdAt    DateTime  @default(now()) @map("created_at")
  updatedAt    DateTime  @updatedAt @map("updated_at")
  publishedAt  DateTime? @map("published_at")

  // Relations
  instructor    User               @relation("InstructorCourses", fields: [instructorId], references: [id])
  modules       CourseModule[]
  enrollments   Enrollment[]
  assignments   Assignment[]
  announcements CourseAnnouncement[]

  @@index([instructorId])
  @@index([status])
  @@map("courses")
}

model CourseModule {
  id          Int      @id @default(autoincrement())
  courseId    Int      @map("course_id")
  title       String
  description String?
  label       String?  // e.g., "Week 1 - Foundations"
  orderIndex  Int      @default(0) @map("order_index")
  isPublished Boolean  @default(false) @map("is_published")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  // Relations
  course   Course    @relation(fields: [courseId], references: [id], onDelete: Cascade)
  lectures Lecture[]
  assignments Assignment[]

  @@index([courseId])
  @@map("course_modules")
}

model Lecture {
  id          Int      @id @default(autoincrement())
  moduleId    Int      @map("module_id")
  title       String
  content     String?  // Rich text / HTML / Markdown (kept for backwards compatibility)
  contentType String   @default("text") @map("content_type") // text, video, mixed
  videoUrl    String?  @map("video_url")
  duration    Int?     // Duration in minutes
  orderIndex  Int      @default(0) @map("order_index")
  isPublished Boolean  @default(false) @map("is_published")
  isFree      Boolean  @default(false) @map("is_free") // Preview lecture
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  // Relations
  module      CourseModule        @relation(fields: [moduleId], references: [id], onDelete: Cascade)
  attachments LectureAttachment[]
  progress    LectureProgress[]
  sections    LectureSection[]

  @@index([moduleId])
  @@map("lectures")
}

model LectureSection {
  id        Int      @id @default(autoincrement())
  lectureId Int      @map("lecture_id")
  title     String?  // Section title (e.g., "Introduction", "Key Concepts")
  type      String   // 'text', 'file', 'ai-generated', 'chatbot', 'assignment'
  content   String?  // For text and ai-generated (rich text/markdown)
  fileName  String?  @map("file_name")
  fileUrl   String?  @map("file_url")
  fileType  String?  @map("file_type")
  fileSize  Int?     @map("file_size")
  order     Int      @default(0)
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // New fields for chatbot sections
  chatbotTitle        String?  @map("chatbot_title")
  chatbotIntro        String?  @map("chatbot_intro")
  chatbotImageUrl     String?  @map("chatbot_image_url")
  chatbotSystemPrompt String?  @map("chatbot_system_prompt")
  chatbotWelcome      String?  @map("chatbot_welcome")

  // New fields for assignment sections
  assignmentId        Int?     @map("assignment_id")
  assignment          Assignment? @relation(fields: [assignmentId], references: [id], onDelete: SetNull)
  showDeadline        Boolean  @default(true) @map("show_deadline")
  showPoints          Boolean  @default(true) @map("show_points")

  lecture Lecture @relation(fields: [lectureId], references: [id], onDelete: Cascade)
  chatbotConversations ChatbotConversation[]
  chatbotInteractionLogs ChatbotInteractionLog[]

  @@index([lectureId])
  @@index([assignmentId])
  @@map("lecture_sections")
}

model LectureAttachment {
  id        Int      @id @default(autoincrement())
  lectureId Int      @map("lecture_id")
  fileName  String   @map("file_name")
  fileUrl   String   @map("file_url")
  fileType  String   @map("file_type") // pdf, doc, ppt, etc.
  fileSize  Int?     @map("file_size")
  createdAt DateTime @default(now()) @map("created_at")

  lecture Lecture @relation(fields: [lectureId], references: [id], onDelete: Cascade)

  @@map("lecture_attachments")
}

// =============================================================================
// LMS - ENROLLMENTS & PROGRESS
// =============================================================================

model Enrollment {
  id           Int       @id @default(autoincrement())
  userId       Int       @map("user_id")
  courseId     Int       @map("course_id")
  status       String    @default("active") // active, completed, dropped
  progress     Float     @default(0) // 0-100 percentage
  enrolledAt   DateTime  @default(now()) @map("enrolled_at")
  completedAt  DateTime? @map("completed_at")
  lastAccessAt DateTime? @map("last_access_at")

  // Relations
  user            User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  course          Course            @relation(fields: [courseId], references: [id], onDelete: Cascade)
  lectureProgress LectureProgress[]

  @@unique([userId, courseId])
  @@index([userId])
  @@index([courseId])
  @@map("enrollments")
}

model LectureProgress {
  id           Int       @id @default(autoincrement())
  enrollmentId Int       @map("enrollment_id")
  lectureId    Int       @map("lecture_id")
  isCompleted  Boolean   @default(false) @map("is_completed")
  completedAt  DateTime? @map("completed_at")
  timeSpent    Int       @default(0) @map("time_spent") // seconds

  enrollment Enrollment @relation(fields: [enrollmentId], references: [id], onDelete: Cascade)
  lecture    Lecture    @relation(fields: [lectureId], references: [id], onDelete: Cascade)

  @@unique([enrollmentId, lectureId])
  @@map("lecture_progress")
}

// =============================================================================
// LMS - ASSIGNMENTS
// =============================================================================

model Assignment {
  id              Int       @id @default(autoincrement())
  courseId        Int       @map("course_id")
  moduleId        Int?      @map("module_id")
  title           String
  description     String?
  instructions    String?
  submissionType  String    @default("text") @map("submission_type") // text, file, mixed
  maxFileSize     Int?      @map("max_file_size") // MB
  allowedFileTypes String?  @map("allowed_file_types") // pdf,doc,jpg,png
  dueDate         DateTime? @map("due_date")
  points          Int       @default(100)
  isPublished     Boolean   @default(false) @map("is_published")
  aiAssisted      Boolean   @default(false) @map("ai_assisted")
  aiPrompt        String?   @map("ai_prompt")
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedAt       DateTime  @updatedAt @map("updated_at")

  // Relations
  course      Course                 @relation(fields: [courseId], references: [id], onDelete: Cascade)
  module      CourseModule?          @relation(fields: [moduleId], references: [id], onDelete: SetNull)
  submissions AssignmentSubmission[]
  lectureSections LectureSection[]

  @@index([courseId])
  @@map("assignments")
}

model AssignmentSubmission {
  id           Int       @id @default(autoincrement())
  assignmentId Int       @map("assignment_id")
  userId       Int       @map("user_id")
  content      String?   // Text submission
  fileUrls     String?   @map("file_urls") // JSON array of file URLs
  status       String    @default("submitted") // draft, submitted, graded, returned
  submittedAt  DateTime  @default(now()) @map("submitted_at")
  grade        Float?
  feedback     String?
  gradedAt     DateTime? @map("graded_at")
  gradedById   Int?      @map("graded_by")
  aiFeedback   String?   @map("ai_feedback")

  // Relations
  assignment Assignment @relation(fields: [assignmentId], references: [id], onDelete: Cascade)
  user       User       @relation("StudentSubmissions", fields: [userId], references: [id], onDelete: Cascade)
  gradedBy   User?      @relation("GradedBy", fields: [gradedById], references: [id])

  @@unique([assignmentId, userId])
  @@index([assignmentId])
  @@index([userId])
  @@map("assignment_submissions")
}

// =============================================================================
// LMS - ANNOUNCEMENTS
// =============================================================================

model CourseAnnouncement {
  id        Int      @id @default(autoincrement())
  courseId  Int      @map("course_id")
  title     String
  content   String
  authorId  Int      @map("author_id")
  createdAt DateTime @default(now()) @map("created_at")

  course Course @relation(fields: [courseId], references: [id], onDelete: Cascade)
  author User   @relation(fields: [authorId], references: [id])

  @@index([courseId])
  @@map("course_announcements")
}

// =============================================================================
// CHATBOT CONVERSATIONS (for lesson chatbot sections)
// =============================================================================

model ChatbotConversation {
  id              Int      @id @default(autoincrement())
  sectionId       Int      @map("section_id")
  section         LectureSection @relation(fields: [sectionId], references: [id], onDelete: Cascade)
  userId          Int      @map("user_id")
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  messages        ChatbotConversationMessage[]

  @@unique([sectionId, userId])
  @@index([sectionId])
  @@index([userId])
  @@map("chatbot_conversations")
}

model ChatbotConversationMessage {
  id              Int      @id @default(autoincrement())
  conversationId  Int      @map("conversation_id")
  conversation    ChatbotConversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  role            String   // 'user' | 'assistant'
  content         String
  createdAt       DateTime @default(now()) @map("created_at")

  @@index([conversationId])
  @@map("chatbot_conversation_messages")
}

// =============================================================================
// CHATBOT INTERACTION LOGS (Comprehensive logging with full context)
// =============================================================================

model ChatbotInteractionLog {
  id                    Int       @id @default(autoincrement())

  // ===== USER CONTEXT =====
  userId                Int?      @map("user_id")
  user                  User?     @relation(fields: [userId], references: [id], onDelete: SetNull)
  userFullname          String?   @map("user_fullname")      // Snapshot at time of interaction
  userEmail             String?   @map("user_email")         // Snapshot at time of interaction
  sessionId             String?   @map("session_id")

  // ===== COURSE HIERARCHY CONTEXT =====
  courseId              Int?      @map("course_id")
  courseTitle           String?   @map("course_title")       // Snapshot
  courseSlug            String?   @map("course_slug")        // Snapshot
  moduleId              Int?      @map("module_id")
  moduleTitle           String?   @map("module_title")       // Snapshot
  moduleOrderIndex      Int?      @map("module_order_index") // Snapshot
  lectureId             Int?      @map("lecture_id")
  lectureTitle          String?   @map("lecture_title")      // Snapshot
  lectureOrderIndex     Int?      @map("lecture_order_index")// Snapshot
  sectionId             Int       @map("section_id")
  section               LectureSection @relation(fields: [sectionId], references: [id], onDelete: Cascade)
  sectionOrderIndex     Int?      @map("section_order_index")// Snapshot

  // ===== CONVERSATION CONTEXT =====
  conversationId        Int?      @map("conversation_id")
  conversationMessageCount Int?   @map("conversation_message_count") // Messages in conversation at this point
  messageIndex          Int?      @map("message_index")      // Index of this message in conversation

  // ===== EVENT DETAILS =====
  eventType             String    @map("event_type")         // 'conversation_start' | 'message_sent' | 'message_received' | 'conversation_cleared' | 'error'
  eventSequence         Int?      @map("event_sequence")     // Sequence number in session

  // ===== CHATBOT CONFIGURATION SNAPSHOT =====
  chatbotTitle          String?   @map("chatbot_title")
  chatbotIntro          String?   @map("chatbot_intro")
  chatbotImageUrl       String?   @map("chatbot_image_url")
  chatbotSystemPrompt   String?   @map("chatbot_system_prompt")
  chatbotWelcomeMessage String?   @map("chatbot_welcome_message")

  // ===== MESSAGE DETAILS =====
  messageContent        String?   @map("message_content")
  messageCharCount      Int?      @map("message_char_count")
  messageWordCount      Int?      @map("message_word_count")
  responseContent       String?   @map("response_content")
  responseCharCount     Int?      @map("response_char_count")
  responseWordCount     Int?      @map("response_word_count")

  // ===== AI RESPONSE METRICS =====
  responseTime          Float?    @map("response_time")      // in seconds
  aiModel               String?   @map("ai_model")
  aiProvider            String?   @map("ai_provider")        // openai, anthropic, etc.
  promptTokens          Int?      @map("prompt_tokens")
  completionTokens      Int?      @map("completion_tokens")
  totalTokens           Int?      @map("total_tokens")

  // ===== ERROR DETAILS =====
  errorMessage          String?   @map("error_message")
  errorCode             String?   @map("error_code")
  errorStack            String?   @map("error_stack")

  // ===== CLIENT CONTEXT =====
  ipAddress             String?   @map("ip_address")
  userAgent             String?   @map("user_agent")
  browserName           String?   @map("browser_name")
  browserVersion        String?   @map("browser_version")
  osName                String?   @map("os_name")
  osVersion             String?   @map("os_version")
  deviceType            String?   @map("device_type")        // desktop, mobile, tablet
  screenWidth           Int?      @map("screen_width")
  screenHeight          Int?      @map("screen_height")
  language              String?   @map("language")
  timezone              String?   @map("timezone")

  // ===== TIMING =====
  timestamp             DateTime  @default(now())
  timestampMs           BigInt?   @map("timestamp_ms")       // Unix timestamp in milliseconds
  sessionStartTime      DateTime? @map("session_start_time")
  sessionDuration       Int?      @map("session_duration")   // seconds since session start

  // ===== ADDITIONAL DATA =====
  metadata              String?   // JSON string for any additional data

  @@index([userId])
  @@index([sectionId])
  @@index([sessionId])
  @@index([timestamp])
  @@index([eventType])
  @@index([courseId])
  @@index([lectureId])
  @@map("chatbot_interaction_logs")
}

// =============================================================================
// USER INTERACTION LOGS (Enhanced with full context)
// =============================================================================

model UserInteractionLog {
  id                    Int       @id @default(autoincrement())

  // ===== USER CONTEXT =====
  userId                Int?      @map("user_id")
  user                  User?     @relation(fields: [userId], references: [id], onDelete: SetNull)
  userFullname          String?   @map("user_fullname")
  userEmail             String?   @map("user_email")
  sessionId             String?   @map("session_id")

  // ===== LOCATION CONTEXT =====
  pageUrl               String?   @map("page_url")
  pagePath              String?   @map("page_path")
  pageTitle             String?   @map("page_title")
  referrerUrl           String?   @map("referrer_url")

  // ===== COURSE CONTEXT (if on course page) =====
  courseId              Int?      @map("course_id")
  courseTitle           String?   @map("course_title")
  moduleId              Int?      @map("module_id")
  moduleTitle           String?   @map("module_title")
  lectureId             Int?      @map("lecture_id")
  lectureTitle          String?   @map("lecture_title")

  // ===== EVENT DETAILS =====
  eventType             String    @map("event_type")         // click, page_view, scroll, form_submit, etc.
  eventCategory         String?   @map("event_category")     // navigation, content, form, etc.
  eventAction           String?   @map("event_action")       // Specific action
  eventLabel            String?   @map("event_label")        // Label for grouping
  eventValue            Float?    @map("event_value")        // Numeric value if applicable
  eventSequence         Int?      @map("event_sequence")     // Sequence in session

  // ===== ELEMENT DETAILS =====
  elementId             String?   @map("element_id")
  elementType           String?   @map("element_type")       // button, link, input, etc.
  elementText           String?   @map("element_text")
  elementHref           String?   @map("element_href")
  elementClasses        String?   @map("element_classes")
  elementName           String?   @map("element_name")
  elementValue          String?   @map("element_value")

  // ===== SCROLL/VIEWPORT =====
  scrollDepth           Int?      @map("scroll_depth")       // Percentage scrolled
  viewportWidth         Int?      @map("viewport_width")
  viewportHeight        Int?      @map("viewport_height")

  // ===== CLIENT CONTEXT =====
  ipAddress             String?   @map("ip_address")
  userAgent             String?   @map("user_agent")
  browserName           String?   @map("browser_name")
  browserVersion        String?   @map("browser_version")
  osName                String?   @map("os_name")
  osVersion             String?   @map("os_version")
  deviceType            String?   @map("device_type")
  screenWidth           Int?      @map("screen_width")
  screenHeight          Int?      @map("screen_height")
  language              String?   @map("language")
  timezone              String?   @map("timezone")

  // ===== TIMING =====
  timestamp             DateTime  @default(now())
  timestampMs           BigInt?   @map("timestamp_ms")
  sessionStartTime      DateTime? @map("session_start_time")
  sessionDuration       Int?      @map("session_duration")
  timeOnPage            Int?      @map("time_on_page")       // seconds on current page

  // ===== ADDITIONAL DATA =====
  metadata              String?

  @@index([userId])
  @@index([sessionId])
  @@index([timestamp])
  @@index([eventType])
  @@index([pagePath])
  @@index([courseId])
  @@map("user_interaction_logs")
}

// =============================================================================
// RESEARCH-GRADE LEARNING ANALYTICS LOGS
// =============================================================================

// ContentEventLog - Student content consumption tracking
model ContentEventLog {
  id                    Int       @id @default(autoincrement())
  userId                Int?      @map("user_id")
  userFullname          String?   @map("user_fullname")
  userEmail             String?   @map("user_email")
  sessionId             String?   @map("session_id")
  courseId              Int?      @map("course_id")
  courseTitle           String?   @map("course_title")
  moduleId              Int?      @map("module_id")
  moduleTitle           String?   @map("module_title")
  lectureId             Int?      @map("lecture_id")
  lectureTitle          String?   @map("lecture_title")
  sectionId             Int?      @map("section_id")
  sectionTitle          String?   @map("section_title")
  eventType             String    @map("event_type")  // lecture_view, video_play, video_pause, video_complete, document_download, scroll_depth_update
  videoPosition         Float?    @map("video_position")
  videoDuration         Float?    @map("video_duration")
  videoPercentWatched   Float?    @map("video_percent_watched")
  scrollDepthPercent    Int?      @map("scroll_depth_percent")
  timeOnPageSeconds     Int?      @map("time_on_page_seconds")
  documentFileName      String?   @map("document_file_name")
  documentFileType      String?   @map("document_file_type")
  ipAddress             String?   @map("ip_address")
  deviceType            String?   @map("device_type")
  browserName           String?   @map("browser_name")
  timezone              String?   @map("timezone")
  timestamp             DateTime  @default(now())
  timestampMs           BigInt?   @map("timestamp_ms")

  @@index([userId, courseId, lectureId, eventType, timestamp])
  @@map("content_event_logs")
}

// AssessmentEventLog - Assignment/quiz tracking
model AssessmentEventLog {
  id                    Int       @id @default(autoincrement())
  userId                Int?      @map("user_id")
  userFullname          String?   @map("user_fullname")
  userEmail             String?   @map("user_email")
  sessionId             String?   @map("session_id")
  courseId              Int?      @map("course_id")
  courseTitle           String?   @map("course_title")
  assignmentId          Int?      @map("assignment_id")
  assignmentTitle       String?   @map("assignment_title")
  submissionId          Int?      @map("submission_id")
  eventType             String    @map("event_type")  // assignment_view, assignment_submit, grade_received, feedback_view
  grade                 Float?
  maxPoints             Float?    @map("max_points")
  previousGrade         Float?    @map("previous_grade")
  attemptNumber         Int?      @map("attempt_number")
  timeSpentSeconds      Int?      @map("time_spent_seconds")
  feedbackLength        Int?      @map("feedback_length")
  ipAddress             String?   @map("ip_address")
  deviceType            String?   @map("device_type")
  browserName           String?   @map("browser_name")
  timestamp             DateTime  @default(now())

  @@index([userId, courseId, assignmentId, eventType, timestamp])
  @@map("assessment_event_logs")
}

// SystemEventLog - Teacher/Admin CRUD actions
model SystemEventLog {
  id                    Int       @id @default(autoincrement())
  actorId               Int?      @map("actor_id")
  actorFullname         String?   @map("actor_fullname")
  actorEmail            String?   @map("actor_email")
  actorRole             String?   @map("actor_role")  // admin, instructor
  eventType             String    @map("event_type")  // course_create, lecture_update, chatbot_config_change, etc.
  eventCategory         String    @map("event_category")  // content_mgmt, grading, user_mgmt
  changeType            String?   @map("change_type")  // create, update, delete
  targetType            String?   @map("target_type")  // course, module, lecture, section, assignment, chatbot
  targetId              Int?      @map("target_id")
  targetTitle           String?   @map("target_title")
  courseId              Int?      @map("course_id")
  courseTitle           String?   @map("course_title")
  targetUserId          Int?      @map("target_user_id")
  targetUserFullname    String?   @map("target_user_fullname")
  targetUserEmail       String?   @map("target_user_email")
  previousValues        String?   @map("previous_values")  // JSON
  newValues             String?   @map("new_values")  // JSON
  ipAddress             String?   @map("ip_address")
  timestamp             DateTime  @default(now())

  @@index([actorId, eventType, eventCategory, targetType, courseId, timestamp])
  @@map("system_event_logs")
}

// AuthEventLog - Authentication tracking
model AuthEventLog {
  id                    Int       @id @default(autoincrement())
  userId                Int?      @map("user_id")
  userFullname          String?   @map("user_fullname")
  userEmail             String    @map("user_email")
  sessionId             String?   @map("session_id")
  sessionDuration       Int?      @map("session_duration")
  eventType             String    @map("event_type")  // login_success, login_failure, logout, password_reset, password_change, session_timeout
  failureReason         String?   @map("failure_reason")
  attemptCount          Int?      @map("attempt_count")
  ipAddress             String?   @map("ip_address")
  userAgent             String?   @map("user_agent")
  deviceType            String?   @map("device_type")
  browserName           String?   @map("browser_name")
  browserVersion        String?   @map("browser_version")
  osName                String?   @map("os_name")
  osVersion             String?   @map("os_version")
  timestamp             DateTime  @default(now())

  @@index([userId, userEmail, eventType, timestamp, ipAddress])
  @@map("auth_event_logs")
}
